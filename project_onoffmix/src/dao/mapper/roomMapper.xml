<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dao.IroomDao">
	<insert id="insertRoom" parameterType="room" useGeneratedKeys="true"
		keyProperty="room_num">
		insert into room values(
		0,#{category_name},#{room_name},#{room_day1},#{room_day2},#{room_day3},#{room_day4},#{recruit_day1},
		#{recruit_day2},#{recruit_day3},#{recruit_day4},#{location_1},#{location_2},#{group_capacity},0,#{room_introduce},
		#{room_detail},#{owner_phone},#{owner_email},#{owner_name},#{owner_id}
		)
	</insert>
	<update id="updateRoom" parameterType="room">
		update room
		set category_name= #{category_name},
		room_name = #{room_name},
		room_day1 = #{room_day1},
		room_day2 = #{room_day2}, 
		room_day3 = #{room_day3}, 
		room_day4 = #{room_day4},
		recruit_day1 = #{recruit_day1}, 
		recruit_day2 = #{recruit_day2},
		recruit_day3 = #{recruit_day3},
		recruit_day4 = #{recruit_day4},
		location_1 = #{location_1},
		location_2 = #{location_2},
		group_capacity = #{group_capacity},
		room_introduce = #{room_introduce},
		room_detail = #{room_detail}		
		where room_num = #{room_num}
	</update>
	<select id="selectAll" resultType="room">
		select b.*, a.fullname from room b left join attach a on b.room_num = a.room_num where count != group_capacity;
	</select>
	<select id="selectCategory" resultType="category">
		select * from category
	</select>
	<select id="selectOne" parameterType="int" resultType="room">
		select
		b.*, a.fullname from room b left join attach a
		on b.room_num = a.room_num
		where b.room_num = #{num}
		<!-- select * from room where room_num = #{num} -->
	</select>
	<select id="selectMyRooms" parameterType="HashMap" resultType="room">
		select * from room where owner_id = #{id} limit ${idx},${rows}
	</select>
	<select id="getCntAllMyRooms" parameterType="String" resultType="int">
		select count(*) as cnt from room where owner_id = #{id}
	</select>
	<select id="getCount" resultType="int">
		select count(*) from room
	</select>
	<insert id="insertAttach" parameterType="HashMap">
		insert
		into attach (fullname,room_num)
		values (#{fullname},#{num})
	</insert>
</mapper>